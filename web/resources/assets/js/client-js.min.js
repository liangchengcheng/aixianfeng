function initializeLoad($scope,$timeout){$scope.start(),$scope.fakeIntro=!0,$timeout(function(){$scope.complete(),$scope.fakeIntro=!1,initializeHighLight()},750)}function initializeHighLight(){$("pre code").each(function(i,block){hljs.highlightBlock(block)})}var pBlogApp={},app=angular.module("pBlogApp",["chieffancypants.loadingBar","ngAnimate","ngRoute","ngSanitize","pBlogApp.filters","pBlogApp.services","pBlogApp.directives"]).config(function($routeProvider,$locationProvider){$routeProvider.when("/index",{templateUrl:"/index/layout",controller:IndexController}),$routeProvider.when("/archives",{templateUrl:"/archives/layout",controller:ArchivesController}),$routeProvider.when("/category",{templateUrl:"/category/layout",controller:CategoryController}),$routeProvider.when("/read",{templateUrl:"/read/layout",controller:ReadController}),$routeProvider.when("/record",{templateUrl:"/record/layout",controller:RecordController}),$routeProvider.when("/about",{templateUrl:"/about/layout",controller:AboutController}),$routeProvider.when("/archives/:timeStamp",{templateUrl:"/archives/layout",controller:ArchivesTimeStampController}),$routeProvider.when("/category/:categorySlug",{templateUrl:"/category/layout",controller:CategorySlugController}),$routeProvider.when("/article/:articleSlug",{templateUrl:"/article/slug/layout",controller:ArticleController}),$routeProvider.when("/read/:bookSlug",{templateUrl:"/read/slug/layout",controller:BookController}),$routeProvider.otherwise({redirectTo:"/index"})}).config(function(cfpLoadingBarProvider){cfpLoadingBarProvider.includeSpinner=!0}).controller("loadingBar",function($scope,$http,$timeout,cfpLoadingBar){$scope.start=function(){cfpLoadingBar.start()},$scope.complete=function(){cfpLoadingBar.complete()}});
var AppDirectives=angular.module("pBlogApp.directives",[]);AppDirectives.directive("appVersion",["version",function(version){return function(scope,elm,attrs){elm.text(version)}}]);
var AppFilters=angular.module("pBlogApp.filters",[]);AppFilters.filter("interpolate",["version",function(version){return function(text){return String(text).replace(/\%VERSION\%/gm,version)}}]);

var AppServices=angular.module("pBlogApp.services",[]);AppServices.value("version","0.1");
function initializeAbout(){$(".menu_bar ul li").each(function(index){5==index?$(this).addClass("active"):$(this).removeClass("active")}),$(document).attr("title","关于 | Pelin的个人博客")}var AboutController=function($scope,$interval,$http,$timeout){initializeAbout(),initializeLoad($scope,$timeout)};
function initializeArchives(){$(".menu_bar ul li").each(function(index){1==index?$(this).addClass("active"):$(this).removeClass("active")}),$(document).attr("title","归档 | Pelin的个人博客")}var ArchivesController=function($scope,$interval,$http,$timeout){$scope.fetchArchivesList=function(){$http.get("/archivesList.json").success(function(data){$scope.archivesList=data.archivesVOList,$scope.articleList=data.archivesVOList[0].articleInfoVOList}).error(function(err){console.log(err)})},initializeArchives(),initializeLoad($scope,$timeout),$scope.fetchArchivesList()};
function initializeArchivesTimeStamp(){$(".menu_bar ul li").each(function(index){1==index?$(this).addClass("active"):$(this).removeClass("active")}),$(document).attr("title","归档 | Pelin的个人博客")}var ArchivesTimeStampController=function($scope,$interval,$http,$timeout,$routeParams){var timeStamp=$routeParams.timeStamp;$scope.fetchArchivesTimeStampList=function(){$http.get("/archives/"+timeStamp+".json").success(function(data){$scope.archivesList=data.archivesVOList,$scope.articleList=data.articleInfoVOList,$scope.timeStamp=timeStamp}).error(function(err){console.log(err)})},initializeArchivesTimeStamp(),initializeLoad($scope,$timeout),$scope.fetchArchivesTimeStampList()};
function initializeArticleSlug(article_title){$(".menu_bar ul li").each(function(){$(this).removeClass("active")}),$(document).attr("title",article_title+" | Pelin的个人博客")}function initializeArticleContent(content_md){var $contentBody=$(".content-body"),contentHTML=marked(content_md),$tempHTML=$("<div></div>").append(contentHTML),counter=0;$tempHTML.find("h2").each(function(){$(this).attr("id","section-"+counter++)}),$contentBody.html($tempHTML);var $navList=$(".nav-list"),topArray=[],navHTML="<ul>";$(".content-body h2").each(function(index){var distance=document.getElementById("section-"+index).offsetTop;topArray[index]=distance,navHTML+=0==index?"<li onclick='scrollArticle("+distance+")' id='nav-section-"+index+"'  class='active'>"+$(this).text()+"</li>":"<li onclick='scrollArticle("+distance+")' id='nav-section-"+index+"'>"+$(this).text()+"</li>"}),navHTML+="</ul>",$navList.html(navHTML),$(window).scroll(function(){var scrollDistance=$("body").scrollTop()+30;scrollDistance>165?$(".content-nav").addClass("fixed"):165>=scrollDistance&&$(".content-nav").removeClass("fixed");for(var i=0;i<topArray.length;i++)if(0==i){if(scrollDistance<=topArray[i+1]){removeActiveClass(topArray),$("#nav-section-0").addClass("active");break}}else if(scrollDistance>=topArray[i]&&scrollDistance<=topArray[i+1]){removeActiveClass(topArray),$("#nav-section-"+i).addClass("active");break}})}function scrollArticle(distance){$("body").animate({scrollTop:distance},300)}function removeActiveClass(topArray){for(var i=0;i<topArray.length;i++)$("#nav-section-"+i).removeClass("active")}var ArticleController=function($scope,$interval,$http,$timeout,$routeParams){var articleSlug=$routeParams.articleSlug;$scope.fetchArticle=function(){$http.get("/article/"+articleSlug+".json").success(function(data){$scope.articleVO=data.articleVO,initializeArticleSlug(data.articleVO.title),initializeArticleContent(data.articleVO.content)})},initializeLoad($scope,$timeout),$scope.fetchArticle()};
function initializeBook(book_title){$(".menu_bar ul li").each(function(index){3==index?$(this).addClass("active"):$(this).removeClass("active")}),$(document).attr("title",book_title+" | Pelin的个人博客")}function initializeBookContent(content_md){var $contentBody=$(".content-body");console.log(marked(content_md)),$contentBody.html(marked(content_md)),$(window).scroll(function(){var scrollDistance=$("body").scrollTop()+30;scrollDistance>165?$(".content-nav").addClass("fixed"):165>=scrollDistance&&$(".content-nav").removeClass("fixed")})}var BookController=function($scope,$interval,$http,$timeout,$routeParams){var bookSlug=$routeParams.bookSlug;$scope.fetchBooksDetail=function(){$http.get("/book/"+bookSlug+".json").success(function(data){initializeBook(data.bookInfoVO.title),initializeBookContent(data.bookInfoVO.content),$scope.bookInfoVO=data.bookInfoVO}).error(function(err){console.log(err)})},initializeLoad($scope,$timeout),$scope.fetchBooksDetail()};
function initializeCategory(){$(".menu_bar ul li").each(function(index){2==index?$(this).addClass("active"):$(this).removeClass("active")}),$(document).attr("title","分类 | Pelin的个人博客")}var CategoryController=function($scope,$interval,$http,$timeout){$scope.fetchCategoryList=function(){$http.get("/categoryList.json").success(function(data){$scope.categoryList=data.categoryInfoVOList,$scope.articleList=data.articleInfoVOList}).error(function(err){console.log(err)})},initializeCategory(),initializeLoad($scope,$timeout),$scope.fetchCategoryList()};
function initializeCategorySlug(){$(".menu_bar ul li").each(function(index){2==index?$(this).addClass("active"):$(this).removeClass("active")}),$(document).attr("title","分类 | Pelin的个人博客")}var CategorySlugController=function($scope,$interval,$http,$timeout,$routeParams){var categorySlug=$routeParams.categorySlug;$scope.fetchCategorySlugList=function(){$http.get("/category/"+categorySlug+".json").success(function(data){$scope.categoryList=data.categoryInfoVOList,$scope.articleList=data.articleInfoVOList}).error(function(err){console.log(err)})},initializeCategorySlug(),initializeLoad($scope,$timeout),$scope.fetchCategorySlugList()};
function initializeIndex(content_md){var $contentBody=$(".content-body");$(".menu_bar ul li").each(function(index){0==index?$(this).addClass("active"):$(this).removeClass("active")}),$(document).attr("title","首页 | Pelin的个人博客"),$contentBody.html(marked(content_md))}function initializeIndexLoad($scope,$timeout){$scope.start(),$scope.fakeIntro=!0,$timeout(function(){$scope.complete(),$scope.fakeIntro=!1,initializeHighLight(),loadSlider()},750)}function loadSlider(){var $container=$(".scroll-area"),$content=$(".index-article-list"),$slideArea=$(".scroll-vertical"),$bar=$(".scroll-bar");$container.slider({container:$container,content:$content,slideArea:$slideArea,bar:$bar})}var IndexController=function($scope,$interval,$http,$timeout){$scope.fetchArticlesList=function(){$http.get("/topTenArticle.json").success(function(data){$scope.detail=data.detail,$scope.articleList=data.pagination.items,$scope.f_article=data.firstArticle,initializeIndex($scope.f_article.content)}).error(function(err){console.log(err)})},initializeIndexLoad($scope,$timeout),$scope.fetchArticlesList()};
function initializeRead(){$(".menu_bar ul li").each(function(index){3==index?$(this).addClass("active"):$(this).removeClass("active")}),$(document).attr("title","读书 | Pelin的个人博客")}var ReadController=function($scope,$interval,$http,$timeout){$scope.fetchBooksList=function(){$http.get("/book/list.json").success(function(data){$scope.bookInfoList=data.bookInfoVOList,$scope.bookTableList=data.bookTableVOList}).error(function(err){console.log(err)})},initializeRead(),initializeLoad($scope,$timeout),$scope.fetchBooksList()};
function initializeRecord(){$(".menu_bar ul li").each(function(index){4==index?$(this).addClass("active"):$(this).removeClass("active")}),$(document).attr("title","记录 | Pelin的个人博客")}var RecordController=function($scope,$interval,$http,$timeout,$routeParams){$scope.fetchRecordList=function(){$http.get("/record.json").success(function(data){$scope.recordInfoList=data.recordInfoList;for(var i=0;i<data.recordInfoList.length;i++)$scope.recordInfoList[i].content=marked(data.recordInfoList[i].content)})},initializeRecord(),initializeLoad($scope,$timeout),$scope.fetchRecordList()};